<!DOCTYPE html>
<html lang="pt-br">
<head>
 <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js">
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyber-Nexis - Sistema Secreto</title>
  <style>
    body {
      background-color: black;
      color: lime;
      font-family: monospace;
      cursor: crosshair;
      margin: 0;
      padding: 0;
    }
    .oculto { display: none; }
    input, button, select, textarea {
      background: black;
      color: lime;
      border: 1px solid lime;
      padding: 5px;
      margin: 5px;
      width: calc(100% - 22px);
    }
    .header, .menu, .content, .logs {
      border: 1px solid lime;
      padding: 10px;
      margin: 5px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
    }
    .menu {
      width: 220px;
    }
    .content {
      flex: 1;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      cursor: pointer;
      padding: 4px;
    }
    ul li:hover {
      background-color: #0f0;
      color: black;
    }
    .codebox {
      background: #111;
      border: 1px dashed lime;
      padding: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 10px;
    }
    .logo {
      width: 100px;
      display: block;
      margin: 10px auto;
    }
    .log-item {
  background-color: black; /* fundo preto */
  color: lime;             /* texto verde */
  font-family: monospace;  /* estilo de terminal */
  padding: 5px 10px;
  margin-bottom: 3px;
  border-left: 3px solid lime; /* efeito visual tipo terminal */
  border-radius: 2px;
  white-space: pre-wrap;   /* mantÃ©m quebras de linha */
}
  </style>
</head>
<body>

<!--SOM-->
<audio id="som-baixo" src="Sons/error_sound-221445.mp3"></audio>
<audio id="som-medio" src="Sons/beep-warning-6387.mp3"></audio>
<audio id="som-critico" src="Sons/siren-alert-96052.mp3"></audio>

<!-- TELA DE CADASTRO -->
<div id="telaCadastro">
  <h2>Cadastro de Agente</h2>
  <input id="cadastro-usuario" placeholder="UsuÃ¡rio"><br>
<input id="cadastro-senha" type="password" placeholder="Senha"><br>
<input id="cadastro-frase" placeholder="Frase de seguranÃ§a"><br>
<select id="cadastro-nivel" onchange="mostrarSetorSeComandante()">
    <option value="Observador">Observador</option>
    <option value="Iniciado">Iniciado</option>
 <option value="Operador">Operador</option>
    <option value="Comandante">Comandante</option>
    <option value="Arquiteto">Arquiteto</option>
>    <option value="LÃ­der Supremo">LÃ­der Supremo</option>
  </select><br/>
  
<div id="escolha-setor" style="display:none; margin-top:10px;">
  <label>Escolha o Setor:</label>
  <select id="cadastro-setor">
    <option value="">-- Selecione o setor --</option>
    <option value="seguranca_info">ğŸ”’ SeguranÃ§a da InformaÃ§Ã£o</option>
    <option value="psicologia">ğŸ§  Psicologia EstratÃ©gica</option>
    <option value="contra_inteligencia">ğŸ­ Contra-InteligÃªncia</option>
    <option value="financas">ğŸ’° FinanÃ§as Secretas</option>
    <option value="operacao_campo">ğŸ›°ï¸ OperaÃ§Ã£o de Campo</option>
    <option value="ia_estrategica">ğŸ¤– IA EstratÃ©gica</option>
  </select>
</div>

<button onclick="verificarCadastro()">âœ… Cadastrar</button>

  <button onclick="irParaLogin()">JÃ¡ tenho cadastro</button>
  <p id="cadastro-msg"></p>
</div>

<!-- TELA DE LOGIN -->
<div id="telaLogin" class="oculto">
  <img src="Imagem/Logo terminal.png" alt="Logo terminal.png" class="logo"/>
  <h2>Acesso Restrito</h2>
  <input type="text" id="login-usuario" placeholder="Agente" />
  <input type="password" id="login-senha" placeholder="Senha" />
  <input type="text" id="login-frase" placeholder="Frase secreta/token" />
  <button onclick="login()">Entrar</button>
  <button onclick="irParaCadastro()">Novo agente</button>
  <p id="login-msg"></p>
</div>

<!-- TELA DO SISTEMA PRINCIPAL -->
<div id="telaSistema" class="oculto">
  <div class="header">
    <h1>ğŸ›¡ï¸ Cyber-Nexis</h1>
    <div id="alertaSistema">NÃ­vel de Alerta: ğŸŸ¢ Baixo</div>
    <button onclick="trocarAlerta()">ğŸ” Alternar Alerta</button>
    <button onclick="logout()">ğŸšª Sair</button>
  </div>

  <div class="container">
    <div class="menu">
      <h3>Setores</h3>
      <ul>
        <li onclick="mostrarSetor('inteligencia')">ğŸ§  InteligÃªncia</li>
        <li onclick="mostrarSetor('seguranca')">ğŸ›¡ï¸ SeguranÃ§a</li>
        <li onclick="mostrarSetor('hacker')">ğŸ’» Hacker AvanÃ§ado</li>
        <li onclick="abrirCriptografia()">ğŸ” Criptografia AES</li>
        <li onclick="abrirLogs()">ğŸ“œ Logs & LocalizaÃ§Ã£o</li>
        <li onclick="abrirMensagens()">ğŸ’¬ Mensagens Secretas</li>
        <li onclick="abrirQuiz()">ğŸ§  Teste PsicolÃ³gico</li>
        <li onclick="abrirOperacoes()">ğŸ›°ï¸ OperaÃ§Ãµes ao Vivo</li>
     <li onclick="abrirPastas()">ğŸ“ Pastas Seguras</li>
<li onclick="abrirSetor('seguranca_info')">ğŸ”’ DivisÃ£o de SeguranÃ§a da InformaÃ§Ã£o</li>
<li onclick="abrirSetor('psicologia')">ğŸ§  DivisÃ£o de Psicologia EstratÃ©gica</li>
<li onclick="abrirSetor('contra_inteligencia')">ğŸ­ DivisÃ£o Contra-InteligÃªncia</li>
<li onclick="abrirSetor('financas')">ğŸ’° DivisÃ£o de FinanÃ§as Secretas</li>
<li onclick="abrirSetor('operacao_campo')">ğŸ›°ï¸ DivisÃ£o de OperaÃ§Ã£o de Campo</li>
<li onclick="abrirSetor('ia_estrategica')">ğŸ¤– DivisÃ£o de IA EstratÃ©gica & Deep Learning</li>
 
        <li onclick="abrirAdmin()">ğŸ‘‘ Painel do LÃ­der Supremo</li>
      </ul>
    </div>

   <div class="content" id="conteudo">
  <h2>Bem-vindo Ã  Cyber-Nexis</h2>
  <img src="Imagem/Logo terminal.png" width="100" height="200 alt="Logo terminal.png" class="logo" />
 
</div>

  <div class="logs">
    <h3>Logs do Sistema</h3>
    <ul id="log-list"></ul>
  </div>
</div>

<script>
let usuarioAtual = null;
let alertaAtual = "baixo";

function mostrarSetorSeComandante() {
  const nivel = document.getElementById("cadastro-nivel").value;
  const setorDiv = document.getElementById("escolha-setor");
  setorDiv.style.display = (nivel === "Comandante") ? "block" : "none";
}

// ===== FUNÃ‡ÃƒO DE CADASTRO =====
function verificarCadastro() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}"); // âœ… coloque logo no inÃ­cio

  const nome = document.getElementById("cadastro-usuario").value.trim();
  const senha = document.getElementById("cadastro-senha").value;
  const frase = document.getElementById("cadastro-frase").value.trim().toLowerCase();
  const nivel = document.getElementById("cadastro-nivel").value;

  if (!nome || !senha || !frase) {
    alert("âš ï¸ Preencha todos os campos.");
    return;
  }

function verificarCadastro() {
  const nome = document.getElementById("cadastro-usuario").value.trim();
  const senha = document.getElementById("cadastro-senha").value;
  const frase = document.getElementById("cadastro-frase").value.trim().toLowerCase();
  const nivel = document.getElementById("cadastro-nivel").value;

  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");

  if (!nome || !senha || !frase || !nivel) {
    alert("âš ï¸ Preencha todos os campos.");
    return;
  }

  // Caso seja comandante
  if (nivel === "Comandante") {
    const setorEscolhido = document.getElementById("cadastro-setor").value;
    if (!setorEscolhido) {
      alert("âš ï¸ Escolha um setor para o Comandante.");
      return;
    }

    const jaExiste = Object.values(usuarios).some(
      u => u.nivel === "Comandante" && u.setor === setorEscolhido
    );
    if (jaExiste) {
      alert(`â›” JÃ¡ existe um Comandante para o setor ${setorEscolhido}.`);
      return;
    }

    usuarios[nome] = { senha, nivel, frase, setor: setorEscolhido };
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    alert(`âœ… Cadastro concluÃ­do! ${nome} Ã© o novo Comandante de ${setorEscolhido}.`);
    abrirSetor(setorEscolhido);
    return;
  }

  // Agente ou LÃ­der Supremo
  usuarios[nome] = { senha, nivel, frase };
  localStorage.setItem("usuarios", JSON.stringify(usuarios));
  alert("âœ… Cadastro realizado com sucesso!");
  irParaLogin();
}

  // ğŸ”’ Impede que exista mais de 1 LÃ­der Supremo
  const jaExisteLider = Object.values(usuarios).some(u => u.nivel === "LÃ­der Supremo");
  if (nivel === "LÃ­der Supremo" && jaExisteLider) {
    alert("â›” JÃ¡ existe um LÃ­der Supremo cadastrado. Apenas um Ã© permitido.");
    return;
  }

  if (usuarios[nome]) {
    alert("âš ï¸ Este agente jÃ¡ existe.");
    return;
  }

  if (nivel === "LÃ­der Supremo") {
    iniciarTesteLider(nome, senha, frase, nivel);
  } else {
    concluirCadastro(nome, senha, frase, nivel);
  }
  // Timestamp para Observador
  let criadoEm = null;
  if (nivel === "Observador") {
    criadoEm = Date.now();
  }

  // Cria o usuÃ¡rio com todos os dados
  usuarios[nome] = { senha, nivel, frase, criadoEm };
  localStorage.setItem("usuarios", JSON.stringify(usuarios));
  alert("âœ… Cadastro realizado com sucesso!");
  irParaLogin();
}

// ===== FUNÃ‡ÃƒO DE LOGIN COM VALIDAÃ‡ÃƒO DE OBSERVADOR =====
function login() {
  const nome = document.getElementById("login-usuario").value.trim();
  const senha = document.getElementById("login-senha").value;
  const frase = document.getElementById("login-frase").value.trim().toLowerCase();
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");

  if (!usuarios[nome]) {
    document.getElementById("login-msg").innerText = "Agente nÃ£o encontrado!";
    return;
  }

  if (usuarios[nome].senha !== senha || usuarios[nome].frase !== frase) {
    document.getElementById("login-msg").innerText = "Senha ou frase secreta incorreta!";
    return;
  }

  const usuario = usuarios[nome];

  // Limite de 24h para Observador
  if (usuario.nivel === "Observador" && usuario.criadoEm) {
    const agora = Date.now();
    const limite = usuario.criadoEm + 24 * 60 * 60 * 1000; // 24h em ms
    if (agora > limite) {
      alert("â›” Sua conta de Observador expirou. Login bloqueado.");
      return;
    }
  }

  usuarioAtual = { nome, nivel: usuario.nivel, criadoEm: usuario.criadoEm };
  localStorage.setItem("sessaoAtual", JSON.stringify(usuarioAtual));
  mostrarTela("telaSistema");
  function registrarAcessoComGeolocalizacao() {
  if (!navigator.geolocation) {
    log("ğŸ›‘ GeolocalizaÃ§Ã£o nÃ£o suportada.");
    return;
  }

  if (confirm("Deseja compartilhar sua localizaÃ§Ã£o com a base da Cyber-Nexis?")) {
    navigator.geolocation.getCurrentPosition(async position => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      const acc = Math.round(position.coords.accuracy); // precisÃ£o em metros

      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
        const data = await response.json();
        const cidade = data.address.city || data.address.town || data.address.village || "Desconhecida";
        const pais = data.address.country || "Desconhecido";

        // Atualiza perfil do usuÃ¡rio
        const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
        if (!usuarios[usuarioAtual.nome].historicoLocais) {
          usuarios[usuarioAtual.nome].historicoLocais = [];
        }
        usuarios[usuarioAtual.nome].historicoLocais.push({
          lat, lon, cidade, pais,
          data: new Date().toLocaleString(),
          precisao: acc
        });
        localStorage.setItem("usuarios", JSON.stringify(usuarios));

        log(`ğŸ›°ï¸ Agente ${usuarioAtual.nome} acessou de ${cidade}, ${pais} (Â±${acc}m)`);

        // Mostra mapa na tela do agente
        mostrarMapa(lat, lon, cidade, pais);

      } catch {
        log(`ğŸŒ Acesso de ${usuarioAtual.nome}, mas falha ao localizar.`);
      }
    }, () => {
      log(`âš ï¸ LocalizaÃ§Ã£o negada por ${usuarioAtual.nome}.`);
    });
  } else {
    log("ğŸ“Œ LocalizaÃ§Ã£o nÃ£o autorizada.");
  }
}
  // Se for Observador, iniciar cronÃ´metro de tempo restante
  if (usuarioAtual.nivel === "Observador") {
    iniciarCronometroObservador();
  }
}

// ===== FUNÃ‡ÃƒO DE CRONÃ”METRO PARA OBSERVADOR =====
function iniciarCronometroObservador() {
  const areaAlerta = document.getElementById("alertaSistema");
  const limite = usuarioAtual.criadoEm + 24 * 60 * 60 * 1000;

  const interval = setInterval(() => {
    const restante = limite - Date.now();
    if (restante <= 0) {
      clearInterval(interval);
      alert("â›” Tempo de Observador expirou. VocÃª serÃ¡ desconectado.");
      logout();
      return;
    }
    const horas = Math.floor(restante / (1000 * 60 * 60));
    const minutos = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));
    const segundos = Math.floor((restante % (1000 * 60)) / 1000);
    areaAlerta.innerHTML = `NÃ­vel de Alerta: ğŸŸ¢ Baixo | Tempo restante: ${horas}h ${minutos}m ${segundos}s`;
  }, 1000);
}

// ===== FUNÃ‡Ã•ES DE NAVEGAÃ‡ÃƒO =====
function mostrarTela(id) {
  ["telaCadastro", "telaLogin", "telaSistema"].forEach(tela => {
    document.getElementById(tela).classList.add("oculto");
  });
  document.getElementById(id).classList.remove("oculto");
}

function irParaLogin() {
  mostrarTela("telaLogin");
}

function irParaCadastro() {
  mostrarTela("telaCadastro");
}

// ===== LOGOUT =====
function logout() {
  usuarioAtual = null;
  localStorage.removeItem("sessaoAtual");
  mostrarTela("telaLogin");
  log("ğŸšª SessÃ£o encerrada.");
}

// ===== LOG =====
function log(mensagem) {
  const ul = document.getElementById("log-list");
  const li = document.createElement("li");
  li.textContent = new Date().toLocaleTimeString() + " - " + mensagem;
  li.classList.add("log-item"); // aplica o estilo de terminal
  ul.appendChild(li);
}

// ===== RESTAURAR SESSÃƒO =====
window.onload = () => {
    const salvo = JSON.parse(localStorage.getItem("sessaoAtual"));
    if (salvo) {
        usuarioAtual = salvo;
        mostrarTela("telaSistema");
        log("ğŸ” SessÃ£o restaurada automaticamente.");

        try {
            registrarAcessoComGeolocalizacao();
        } catch (e) {
            console.error("Erro na geolocalizaÃ§Ã£o:", e);
        }

        if (usuarioAtual.nivel === "Observador") {
            iniciarCronometroObservador();
        }
    } else {""
        mostrarTela("telaCadastro");
    }
};

  function tocarSomAlerta(nivel) {
  document.getElementById("som-baixo").pause();
  document.getElementById("som-medio").pause();
  document.getElementById("som-critico").pause();

  if (nivel === "baixo") document.getElementById("som-baixo").play();
  else if (nivel === "mÃ©dio") document.getElementById("som-medio").play();
  else if (nivel === "crÃ­tico") document.getElementById("som-critico").play();
}

function trocarAlerta() {
  const alerta = document.getElementById("alertaSistema");
  if (alertaAtual === "baixo") {
    alertaAtual = "mÃ©dio";
    alerta.innerHTML = "NÃ­vel de Alerta: ğŸŸ¡ MÃ©dio";
    alerta.style.color = "yellow";
  } else if (alertaAtual === "mÃ©dio") {
    alertaAtual = "crÃ­tico";
    alerta.innerHTML = "NÃ­vel de Alerta: ğŸ”´ CrÃ­tico";
    alerta.style.color = "red";
  } else {
    alertaAtual = "baixo";
    alerta.innerHTML = "NÃ­vel de Alerta: ğŸŸ¢ Baixo";
    alerta.style.color = "lime";
  }
  tocarSomAlerta(alertaAtual); // ğŸ”Š reproduz som
  log("ğŸš¨ Alerta ajustado para " + alertaAtual.toUpperCase());
}

  function registrarAcessoComGeolocalizacao() {
    if (!navigator.geolocation) {
      log("ğŸ›‘ GeolocalizaÃ§Ã£o nÃ£o suportada.");
      return;
    }

    if (confirm("Deseja compartilhar sua localizaÃ§Ã£o com a base da Cyber-Nexis?")) {
      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
          const data = await response.json();
          const cidade = data.address.city || data.address.town || data.address.village || "Desconhecida";
          const pais = data.address.country || "Desconhecido";
          log(`ğŸ›°ï¸ Agente ${usuarioAtual.nome} acessou de ${cidade}, ${pais}`);
        } catch {
          log(`ğŸŒ Acesso de ${usuarioAtual.nome}, mas falha ao localizar.`);
        }
      }, () => {
        log(`âš ï¸ LocalizaÃ§Ã£o negada por ${usuarioAtual.nome}.`);
      });
    } else {
      log("ğŸ“Œ LocalizaÃ§Ã£o nÃ£o autorizada.");
    }
  };
</script>

<script>
  const perguntasQuiz = [
    {
      imagem: "quiz1.jpg",
      pergunta: "VocÃª descobriu uma falha que dÃ¡ acesso a dados bancÃ¡rios. O que faz?",
      opcoes: [
        { texto: "Explora para ganhar dinheiro.", pontos: 0 },
        { texto: "Ignora, nÃ£o Ã© problema seu.", pontos: 1 },
        { texto: "Reporta de forma anÃ´nima.", pontos: 2 }
      ]
    },
    {
      imagem: "quiz2.jpg",
      pergunta: "Seu melhor amigo estÃ¡ cometendo crimes digitais. VocÃª:",
      opcoes: [
        { texto: "Encobre para protegÃª-lo.", pontos: 0 },
        { texto: "Confronta, mas nÃ£o denuncia.", pontos: 1 },
        { texto: "Reporta ou tenta impedir.", pontos: 2 }
      ]
    },
    {
      imagem: "quiz3.jpg",
      pergunta: "Um sistema opressor censura a internet. VocÃª:",
      opcoes: [
        { texto: "Invade e sabota servidores.", pontos: 2 },
        { texto: "Faz protesto pacÃ­fico online.", pontos: 1 },
        { texto: "Evita se envolver.", pontos: 0 }
      ]
    },
    {
      imagem: "quiz4.jpg",
      pergunta: "Te oferecem muito dinheiro para vazar dados de inocentes. VocÃª:",
      opcoes: [
        { texto: "Aceita sem pensar.", pontos: 0 },
        { texto: "Recusa a oferta.", pontos: 2 },
        { texto: "Finge aceitar e avisa a vÃ­tima.", pontos: 1 }
      ]
    },
    {
      imagem: "quiz5.jpg",
      pergunta: "VocÃª pode sabotar um polÃ­tico corrupto. VocÃª:",
      opcoes: [
        { texto: "ExpÃµe dados com provas reais.", pontos: 2 },
        { texto: "Divulga fakes para enfraquecer.", pontos: 0 },
        { texto: "NÃ£o se envolve com polÃ­tica.", pontos: 1 }
      ]
    },
    {
      imagem: "quiz6.jpg",
      pergunta: "Se fosse lÃ­der da Cyber-Nexis, seu foco seria:",
      opcoes: [
        { texto: "Poder e dominaÃ§Ã£o digital.", pontos: 0 },
        { texto: "EducaÃ§Ã£o e liberdade da informaÃ§Ã£o.", pontos: 2 },
        { texto: "ProteÃ§Ã£o e sigilo absoluto.", pontos: 1 }
      ]
    },
    {
      imagem: "quiz7.jpg",
      pergunta: "VocÃª vÃª injustiÃ§a social aumentada por tecnologia. VocÃª:",
      opcoes: [
        { texto: "Cria soluÃ§Ãµes acessÃ­veis para todos.", pontos: 2 },
        { texto: "Denuncia online com provas.", pontos: 1 },
        { texto: "Ignora, pois nÃ£o Ã© afetado.", pontos: 0 }
      ]
    },
    {
      imagem: "quiz8.jpg",
      pergunta: "VocÃª tem acesso a um sistema de vigilÃ¢ncia global. VocÃª:",
      opcoes: [
        { texto: "Usa para monitorar e proteger.", pontos: 1 },
        { texto: "Divulga as falhas ao pÃºblico.", pontos: 2 },
        { texto: "Usa para espionar rivais.", pontos: 0 }
      ]
    },
    {
      imagem: "quiz9.jpg",
      pergunta: "Se pudesse apagar todo histÃ³rico digital de alguÃ©m. VocÃª:",
      opcoes: [
        { texto: "Usa como chantagem.", pontos: 0 },
        { texto: "Apaga para dar segunda chance.", pontos: 2 },
        { texto: "Venda para empresas.", pontos: 0 }
      ]
    },
    {
      imagem: "quiz10.jpg",
      pergunta: "O que significa 'Ã©tica hacker' para vocÃª?",
      opcoes: [
        { texto: "Quebrar regras por diversÃ£o.", pontos: 0 },
        { texto: "Usar o conhecimento com responsabilidade.", pontos: 2 },
        { texto: "Fazer o que for necessÃ¡rio.", pontos: 1 }
      ]
    }
  ];

  let indiceAtual = 0;
  let pontuacao = 0;

  function abrirQuiz() {
    indiceAtual = 0;
    pontuacao = 0;
    mostrarPerguntaQuiz();
    log("ğŸ§  Iniciou Teste PsicolÃ³gico");
  }

  function mostrarPerguntaQuiz() {
    const conteudo = document.getElementById("conteudo");
    const pergunta = perguntasQuiz[indiceAtual];

    let opcoesHtml = "";
    pergunta.opcoes.forEach((op, i) => {
      opcoesHtml += `<button onclick="responderQuiz(${op.pontos})">${op.texto}</button><br>`;
    });
   conteudo.innerHTML = `
      <h2>ğŸ§  Teste PsicolÃ³gico (${indiceAtual + 1}/10)</h2>
      <img src="${pergunta.imagem}" alt="Imagem Quiz" style="max-width:100%; border:1px solid lime; margin-bottom:10px;"><br>
      <p><strong>${pergunta.pergunta}</strong></p>
      ${opcoesHtml}
    `;
  }
function responderQuiz(pontos) {
  pontuacao += pontos;
  indiceAtual++;
  if (indiceAtual < perguntasQuiz.length) {
    mostrarPerguntaQuiz();
  } else {
    finalizarQuiz();
  }
}

// final do quiz
function finalizarQuiz() {
  let nivelFinal = "";
  if (pontuacao <= 3) {
    nivelFinal = "Observador";
  } else if (pontuacao <= 6) {
    nivelFinal = "Iniciado";
  } else if (pontuacao <= 8) {
    nivelFinal = "Operador";
  } else {
    nivelFinal = "Comandante";
  }

  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  usuarios[usuarioAtual.nome].nivel = nivelFinal;
  localStorage.setItem("usuarios", JSON.stringify(usuarios));
  usuarioAtual.nivel = nivelFinal;

  const conteudo = document.getElementById("conteudo");
  conteudo.innerHTML = `
    <h2>âœ… Teste Finalizado</h2>
    <p>VocÃª atingiu <strong>${pontuacao} ponto(s)</strong>.</p>
    <p>NÃ­vel atribuÃ­do: <strong>${nivelFinal}</strong></p>
  `;
  log(`ğŸ§  Teste concluÃ­do â€” novo nÃ­vel: ${nivelFinal}`);
}
  
</script>

<script>
  // ===== CRIPTOGRAFIA AES =====
  let chaveAES = null;

  function abrirCriptografia() {
    const conteudo = document.getElementById("conteudo");
    conteudo.innerHTML = `
      <h2>ğŸ” Criptografia AES (GCM)</h2>
      <button onclick="gerarChave()">ğŸ”‘ Gerar Nova Chave</button><br><br>
      <label>Mensagem:</label><br>
      <textarea id="mensagem-cripto" rows="4"></textarea><br>
      <button onclick="criptografarAES()">Criptografar</button>
      <button onclick="descriptografarAES()">Descriptografar</button><br><br>
      <label>Resultado:</label><br>
      <textarea id="resultado-cripto" rows="4" readonly></textarea><br>
      <label>Chave AES (Base64):</label><br>
      <textarea id="chave-base64" rows="2" readonly></textarea>
    `;
    log("ğŸ” Acessou mÃ³dulo de Criptografia");
  }

  async function gerarChave() {
    chaveAES = await crypto.subtle.generateKey({ name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"]);
    const raw = await crypto.subtle.exportKey("raw", chaveAES);
    const base64 = btoa(String.fromCharCode(...new Uint8Array(raw)));
    document.getElementById("chave-base64").value = base64;
    log("ğŸ”‘ Nova chave AES gerada");
  }

  async function criptografarAES() {
    const texto = document.getElementById("mensagem-cripto").value;
    if (!chaveAES) return alert("Gere a chave primeiro.");
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const dados = new TextEncoder().encode(texto);
    const cifrado = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, chaveAES, dados);
    const resultado = {
      iv: Array.from(iv),
      dados: Array.from(new Uint8Array(cifrado))
    };
    document.getElementById("resultado-cripto").value = btoa(JSON.stringify(resultado));
    log("ğŸ”’ Mensagem criptografada");
  }

  async function descriptografarAES() {
    const base64 = document.getElementById("resultado-cripto").value;
    if (!chaveAES) return alert("Gere a chave primeiro.");
    try {
      const obj = JSON.parse(atob(base64));
      const iv = new Uint8Array(obj.iv);
      const dados = new Uint8Array(obj.dados);
      const decifrado = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, chaveAES, dados);
      const texto = new TextDecoder().decode(decifrado);
      document.getElementById("mensagem-cripto").value = texto;
      log("ğŸ”“ Mensagem descriptografada");
    } catch {
      alert("âŒ Erro na descriptografia.");
      log("âš ï¸ Falha na descriptografia");
    }
  }

  // ===== MENSAGENS SECRETAS COM TEMPO LIMITADO =====
function abrirMensagens() {
  const conteudo = document.getElementById("conteudo");
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");

  let opcoes = "";
  for (let nome in usuarios) {
    if (nome !== usuarioAtual.nome) {
      opcoes += `<option value="${nome}">${nome}</option>`;
    }
  }

  conteudo.innerHTML = `
    <h2>ğŸ’¬ Mensagens Secretas</h2>
    <h3>Enviar Mensagem</h3>
    <select id="destinatario">${opcoes}</select><br>
    <textarea id="mensagem-secreta" rows="4"></textarea><br>
    <label>Tempo de expiraÃ§Ã£o (segundos):</label>
    <input type="number" id="tempo-expiracao" value="60" min="5" max="3600"><br>
    <button onclick="enviarMensagem()">Enviar</button>
    <h3>ğŸ“¥ Caixa de Entrada</h3>
    <div id="caixa-entrada"></div>
  `;

  exibirMensagens();
  log("ğŸ’¬ Acessou Mensagens Secretas");

  // Atualiza automaticamente a cada 5 segundos
  setInterval(() => {
    if (document.getElementById("caixa-entrada")) {
      exibirMensagens();
    }
  }, 5000);
}

function enviarMensagem() {
  const para = document.getElementById("destinatario").value;
  const texto = document.getElementById("mensagem-secreta").value.trim();
  const tempo = parseInt(document.getElementById("tempo-expiracao").value, 10) || 60;

  if (!texto) return alert("Digite uma mensagem!");
  if (tempo < 5) return alert("O tempo mÃ­nimo Ã© 5 segundos.");

  const expiracao = Date.now() + tempo * 1000;
  const codificada = btoa(texto);
  const todas = JSON.parse(localStorage.getItem("mensagens") || "{}");
  if (!todas[para]) todas[para] = [];

  todas[para].push({
    de: usuarioAtual.nome,
    conteudo: codificada,
    data: new Date().toLocaleString(),
    expiracao
  });

  localStorage.setItem("mensagens", JSON.stringify(todas));
  document.getElementById("mensagem-secreta").value = "";
  alert(`Mensagem enviada! Ela serÃ¡ apagada automaticamente em ${tempo} segundos.`);
  log(`ğŸ“¨ Mensagem enviada para ${para}`);
  exibirMensagens();
}

function exibirMensagens() {
  const caixa = document.getElementById("caixa-entrada");
  const todas = JSON.parse(localStorage.getItem("mensagens") || "{}");
  const agora = Date.now();

  // Remove mensagens expiradas
  for (let usuario in todas) {
    todas[usuario] = todas[usuario].filter(msg => !msg.expiracao || msg.expiracao > agora);
  }
  localStorage.setItem("mensagens", JSON.stringify(todas));

  const mensagens = todas[usuarioAtual.nome] || [];
  if (mensagens.length === 0) {
    caixa.innerHTML = "<p>(Nenhuma mensagem recebida)</p>";
    return;
  }

  let html = "<ul>";
  mensagens.forEach((msg, i) => {
    const tempoRestante = Math.max(0, Math.floor((msg.expiracao - agora) / 1000));
    html += `
      <li>
        <strong>De:</strong> ${msg.de}<br>
        <strong>Data:</strong> ${msg.data}<br>
        <strong>Mensagem:</strong> ${atob(msg.conteudo)}<br>
        <em>â±ï¸ Expira em: ${tempoRestante}s</em>
      </li><hr>`;
  });
  html += "</ul>";
  caixa.innerHTML = html;
}

  // ===== OPERAÃ‡Ã•ES EM TEMPO REAL =====
  let operacoes = JSON.parse(localStorage.getItem("operacoes") || "[]");

  function abrirOperacoes() {
    const conteudo = document.getElementById("conteudo");
    conteudo.innerHTML = `
      <h2>ğŸ›°ï¸ OperaÃ§Ãµes ao Vivo</h2>
      <button onclick="novaOperacao()">â• Nova OperaÃ§Ã£o</button>
      <div id="lista-operacoes"></div>`;
    exibirOperacoes();
    log("ğŸ¯ Acessou OperaÃ§Ãµes ao Vivo");
  }

  function novaOperacao() {
    const nome = prompt("Nome da nova operaÃ§Ã£o:");
    if (!nome) return;
    const nova = {
      id: Date.now(),
      nome,
      criador: usuarioAtual.nome,
      status: "Ativa",
      eventos: [
        { hora: new Date().toLocaleTimeString(), descricao: `ğŸ”ƒ OperaÃ§Ã£o '${nome}' iniciada por ${usuarioAtual.nome}` }
      ]
    };
    operacoes.push(nova);
    localStorage.setItem("operacoes", JSON.stringify(operacoes));
    exibirOperacoes();
    log(`â• Nova operaÃ§Ã£o: ${nome}`);
  }

  function exibirOperacoes() {
    const area = document.getElementById("lista-operacoes");
    if (operacoes.length === 0) {
      area.innerHTML = "<p>(Nenhuma operaÃ§Ã£o ativa)</p>";
      return;
    }

    area.innerHTML = "";
    operacoes.forEach(op => {
      area.innerHTML += `
        <div style="border:1px solid lime; padding:10px; margin:10px;">
          <h3>ğŸ›°ï¸ ${op.nome}</h3>
          <p><strong>Criador:</strong> ${op.criador} | <strong>Status:</strong> ${op.status}</p>
          <div id="linha-${op.id}" style="background:#000; padding:5px; border:1px solid #0f0; max-height:150px; overflow:auto;">
            ${op.eventos.map(e => `<p>ğŸ•’ ${e.hora} - ${e.descricao}</p>`).join("")}
          </div>
          <textarea id="input-${op.id}" rows="2" cols="50" placeholder="Atualizar operaÃ§Ã£o..."></textarea><br>
          <button onclick="atualizarOperacao(${op.id})">â¤ Atualizar</button>
          <button onclick="encerrarOperacao(${op.id})">ğŸ›‘ Encerrar</button>
        </div>`;
    });
  }

  function atualizarOperacao(id) {
    const index = operacoes.findIndex(op => op.id === id);
    const texto = document.getElementById(`input-${id}`).value.trim();
    if (!texto) return;

    const evento = {
      hora: new Date().toLocaleTimeString(),
      descricao: `${usuarioAtual.nome}: ${texto}`
    };

    operacoes[index].eventos.push(evento);
    localStorage.setItem("operacoes", JSON.stringify(operacoes));
    exibirOperacoes();
    log(`ğŸ“¡ OperaÃ§Ã£o ${operacoes[index].nome} atualizada`);
  }

  function encerrarOperacao(id) {
    const index = operacoes.findIndex(op => op.id === id);
    operacoes[index].status = "Encerrada";
    operacoes[index].eventos.push({
      hora: new Date().toLocaleTimeString(),
      descricao: `ğŸ›‘ OperaÃ§Ã£o encerrada por ${usuarioAtual.nome}`
    });
    localStorage.setItem("operacoes", JSON.stringify(operacoes));
    exibirOperacoes();
    log(`ğŸ›‘ OperaÃ§Ã£o encerrada: ${operacoes[index].nome}`);
  }

  // ===== PAINEL DO LÃDER SUPREMO =====
  function abrirAdmin() {
    if (!usuarioAtual || usuarioAtual.nivel !== "LÃ­der Supremo") {
      alert("â›” Acesso restrito ao LÃ­der Supremo.");
      log("ğŸš« Tentativa de acesso nÃ£o autorizada ao Painel do LÃ­der");
      return;
    }

    const conteudo = document.getElementById("conteudo");
    const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");

    let lista = "";
    for (let nome in usuarios) {
      lista += `
        <li>
          ğŸ‘¤ ${nome} â€” ${usuarios[nome].nivel}
          <button onclick="removerUsuario('${nome}')">ğŸ—‘ï¸</button>
          <button onclick="promoverUsuario('${nome}')">â¬†ï¸</button>
        </li>
      `;
    }

    conteudo.innerHTML = `
      <h2>ğŸ‘‘ Painel Administrativo - LÃ­der Supremo</h2>
      <h3>ğŸŒ HistÃ³rico de LocalizaÃ§Ãµes</h3>
<div id="historico-local"></div>
      <h3>ğŸ•µï¸ Agentes Registrados</h3>
      <ul>${lista}</ul>
      <hr>
      <h3>âš™ï¸ Controles Globais</h3>
      <button onclick="limparTudo()">ğŸ§¨ Resetar Sistema</button>
      <button onclick="limparLogs()">ğŸ§¹ Limpar Logs Visuais</button>
    `;
    log("ğŸ‘‘ LÃ­der Supremo acessou o Painel Administrativo");
  }

  function removerUsuario(nome) {
    if (confirm(`Deseja remover o agente ${nome}?`)) {
      const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
      delete usuarios[nome];
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      log(`âŒ Agente ${nome} removido`);
      abrirAdmin(); // Recarrega
    }
  }

function mostrarHistoricoLocal() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  let html = "<ul>";
  for (let nome in usuarios) {
    if (usuarios[nome].historicoLocais) {
      html += `<li><strong>${nome}</strong><ul>`;
      usuarios[nome].historicoLocais.forEach(loc => {
        html += `<li>ğŸ“ ${loc.cidade}, ${loc.pais} â€” ${loc.data} (Â±${loc.precisao}m)</li>`;
      });
      html += "</ul></li>";
    }
  }
  html += "</ul>";
  document.getElementById("historico-local").innerHTML = html;
}
  function promoverUsuario(nome) {
    const novoNivel = prompt(`Digite o novo nÃ­vel para ${nome} (ex: Operador, Comandante):`);
    if (!novoNivel) return;
    const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
    usuarios[nome].nivel = novoNivel;
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    log(`â¬†ï¸ Agente ${nome} promovido para ${novoNivel}`);
    abrirAdmin(); // Recarrega
  }

  function limparTudo() {
    if (confirm("âš ï¸ Isso apagarÃ¡ TODOS os dados da Cyber-Nexis. Tem certeza?")) {
      localStorage.clear();
      log("ğŸ§¨ Sistema foi resetado pelo LÃ­der Supremo");
      alert("Sistema reiniciado. Recarregue a pÃ¡gina.");
      location.reload();
    }
  }

  function limparLogs() {
    document.getElementById("log-list").innerHTML = "";
    log("ğŸ§¹ Logs visuais foram apagados");
  }
  
// ===== UTILITÃRIOS =====
function getPastas() {
  return JSON.parse(localStorage.getItem("pastas") || "{}");
}

function setPastas(pastas) {
  localStorage.setItem("pastas", JSON.stringify(pastas));
}

function logAcao(mensagem) {
  const logList = document.getElementById("log-list");
  const li = document.createElement("li");
  li.textContent = `${new Date().toLocaleTimeString()} - ${mensagem}`;
  logList.appendChild(li);
}

// ===== ABRIR PASTAS =====
function abrirPastas() {
  const conteudo = document.getElementById("conteudo");
  const pastas = getPastas();

  let listaPastas = "";
  for (let nome in pastas) {
    listaPastas += `
      <li>
        ${nome} 
        <button onclick="abrirPasta('${nome}')">Abrir</button>
        <button onclick="removerPasta('${nome}')">ğŸ—‘ï¸ Apagar</button>
      </li>`;
  }

  conteudo.innerHTML = `
    <h2>ğŸ“ Pastas Seguras</h2>
    <h3>Criar Nova Pasta</h3>
    <input type="text" id="nova-pasta-nome" placeholder="Nome da pasta"><br>
    <input type="password" id="nova-pasta-senha" placeholder="Senha da pasta"><br>
    <button onclick="criarPasta()">Criar Pasta</button>
    <hr>
    <h3>Pastas Existentes</h3>
    <ul>${listaPastas || "<p>(Nenhuma pasta criada)</p>"}</ul>
    <div id="area-pasta"></div>
  `;
}

// ===== CRIAR PASTA =====
function criarPasta() {
  const nome = document.getElementById("nova-pasta-nome").value.trim();
  const senha = document.getElementById("nova-pasta-senha").value;

  if (!nome || !senha) return alert("Preencha nome e senha!");

  const pastas = getPastas();
  if (pastas[nome]) return alert("Pasta jÃ¡ existe!");

  pastas[nome] = { senha, arquivos: {} };
  setPastas(pastas);
  alert(`Pasta "${nome}" criada com sucesso!`);
  abrirPastas();
  logAcao(`Pasta "${nome}" criada.`);
}

// ===== ABRIR PASTA =====
function abrirPasta(nome) {
  const senha = prompt(`Digite a senha da pasta "${nome}":`);
  if (!senha) return;

  const pastas = getPastas();
  if (!pastas[nome]) return alert("Pasta nÃ£o encontrada!");
  if (pastas[nome].senha !== senha) return alert("Senha incorreta!");

  mostrarConteudoPasta(nome, pastas[nome]);
  logAcao(`Pasta "${nome}" aberta.`);
}

// ===== MOSTRAR CONTEÃšDO DA PASTA =====
function mostrarConteudoPasta(nome, pasta) {
  const area = document.getElementById("area-pasta");

  // Ordenar arquivos por nome
  const arquivosOrdenados = Object.keys(pasta.arquivos).sort();

  let listaArquivos = "";
  arquivosOrdenados.forEach(arquivo => {
    listaArquivos += `
      <li>
        ${arquivo} 
        <button onclick="editarArquivo('${nome}','${arquivo}')">âœï¸ Editar</button>
        <button onclick="baixarArquivo('${arquivo}', '${pasta.arquivos[arquivo]}')">â¬‡ï¸ Baixar</button>
        <button onclick="removerArquivo('${nome}','${arquivo}')">ğŸ—‘ï¸ Apagar</button>
      </li>`;
  });

  area.innerHTML = `
    <h3>ğŸ“‚ Pasta: ${nome}</h3>

    <h4>Criar Arquivo de Texto</h4>
    <input type="text" id="novo-arquivo-nome" placeholder="Nome do arquivo"><br>
    <textarea id="novo-arquivo-conteudo" rows="4" placeholder="ConteÃºdo"></textarea><br>
    <button onclick="criarArquivo('${nome}')">Salvar Arquivo</button>

    <h4>ğŸ“¤ Upload de Arquivo</h4>
    <input type="file" id="upload-arquivo"><br>
    <div id="drop-area" style="border:2px dashed lime; padding:20px; margin-top:10px; text-align:center;">
      Arraste arquivos aqui
    </div>
    <button onclick="uploadArquivo('${nome}')">Enviar Arquivo</button>

    <hr>
    <h4>Arquivos Existentes</h4>
    <ul>${listaArquivos || "<p>(Nenhum arquivo)</p>"}</ul>

    <div id="preview-arquivo"></div>
  `;

  // Drag & Drop
  const dropArea = document.getElementById("drop-area");
  dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.style.background="#222"; });
  dropArea.addEventListener("dragleave", e => { dropArea.style.background=""; });
  dropArea.addEventListener("drop", e => {
    e.preventDefault();
    const arquivos = e.dataTransfer.files;
    handleUploadFiles(nome, arquivos);
  });
}

// ===== CRIAR ARQUIVO DE TEXTO =====
function criarArquivo(nomePasta) {
  const arquivo = document.getElementById("novo-arquivo-nome").value.trim();
  const conteudo = document.getElementById("novo-arquivo-conteudo").value;

  if (!arquivo) return alert("Digite o nome do arquivo!");

  const pastas = getPastas();
  pastas[nomePasta].arquivos[arquivo] = btoa(conteudo);
  setPastas(pastas);

  alert(`Arquivo "${arquivo}" salvo!`);
  abrirPasta(nomePasta);
  logAcao(`Arquivo "${arquivo}" criado na pasta "${nomePasta}".`);
}

// ===== EDITAR ARQUIVO =====
function editarArquivo(nomePasta, arquivo) {
  const pastas = getPastas();
  const conteudo = atob(pastas[nomePasta].arquivos[arquivo]);

  const novoConteudo = prompt(`Editar arquivo "${arquivo}":`, conteudo);
  if (novoConteudo === null) return;

  pastas[nomePasta].arquivos[arquivo] = btoa(novoConteudo);
  setPastas(pastas);
  alert(`Arquivo "${arquivo}" atualizado!`);
  abrirPasta(nomePasta);
  logAcao(`Arquivo "${arquivo}" editado na pasta "${nomePasta}".`);
}

// ===== DOWNLOAD DE ARQUIVO =====
function baixarArquivo(nomeArquivo, dataBase64) {
  const conteudo = atob(dataBase64);
  const blob = new Blob([conteudo], { type: "application/octet-stream" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = nomeArquivo;
  a.click();
  URL.revokeObjectURL(url);

  logAcao(`Arquivo "${nomeArquivo}" baixado.`);
}

// ===== REMOVER ARQUIVO =====
function removerArquivo(nomePasta, arquivo) {
  if (!confirm(`Apagar arquivo "${arquivo}"?`)) return;

  const pastas = getPastas();
  delete pastas[nomePasta].arquivos[arquivo];
  setPastas(pastas);
  abrirPasta(nomePasta);
  logAcao(`Arquivo "${arquivo}" removido da pasta "${nomePasta}".`);
}

// ===== REMOVER PASTA =====
function removerPasta(nome) {
  if (!confirm(`Apagar pasta "${nome}" e todos os arquivos?`)) return;

  const pastas = getPastas();
  delete pastas[nome];
  setPastas(pastas);
  abrirPastas();
  logAcao(`Pasta "${nome}" removida.`);
}

// ===== UPLOAD DE ARQUIVOS =====
function uploadArquivo(nomePasta) {
  const fileInput = document.getElementById("upload-arquivo");
  if (fileInput.files.length === 0) return alert("Selecione um arquivo!");
  handleUploadFiles(nomePasta, fileInput.files);
}

// ===== HANDLER DE UPLOAD =====
function handleUploadFiles(nomePasta, arquivos) {
  const pastas = getPastas();
  Array.from(arquivos).forEach(file => {
    if (file.size > 2 * 1024 * 1024) return alert(`Arquivo "${file.name}" excede 2MB!`);

    const reader = new FileReader();
    reader.onload = function(e) {
      pastas[nomePasta].arquivos[file.name] = e.target.result;
      setPastas(pastas);
      abrirPasta(nomePasta);
      logAcao(`Arquivo "${file.name}" enviado para pasta "${nomePasta}".`);
    };
    reader.readAsDataURL(file);
  });
}

function notificarSistema(mensagem) {
  const area = document.getElementById("conteudo"); // ou outra div de notificaÃ§Ãµes
  const div = document.createElement("div");
  div.textContent = mensagem;
  div.classList.add("log-item"); // mesmo estilo de terminal
  area.prepend(div); // adiciona no topo da Ã¡rea
}

function mostrarMapa(lat, lon, cidade, pais) {
  const conteudo = document.getElementById("conteudo");
  conteudo.innerHTML = `
    <h2>ğŸŒ LocalizaÃ§Ã£o Atual</h2>
    <p>ğŸ“ ${cidade}, ${pais}</p>
    <div id="mapa" style="height:400px; border:1px solid lime; margin-top:10px;"></div>
  `;

  const mapa = L.map('mapa').setView([lat, lon], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(mapa);

  L.marker([lat, lon]).addTo(mapa)
    .bindPopup(`Agente ${usuarioAtual.nome}<br>${cidade}, ${pais}`)
    .openPopup();
}

function abrirSetor(idSetor) {
  const setores = JSON.parse(localStorage.getItem("setores") || "{}");
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");

  // Verifica se existe comandante registrado
  if (!setores[idSetor]) {
    alert("âš ï¸ Ainda nÃ£o existe comandante para este setor.");
    log(`ğŸš« Tentativa de acesso ao setor ${idSetor} sem comandante.`);
    return;
  }

  // Verifica se usuÃ¡rio tem permissÃ£o
  if (
    usuarioAtual.nome !== setores[idSetor] &&
    usuarioAtual.nivel !== "LÃ­der Supremo"
  ) {
    alert("â›” Acesso negado. Apenas o comandante deste setor ou o LÃ­der Supremo podem acessar.");
    log(`ğŸš« Acesso negado ao setor ${idSetor} por ${usuarioAtual.nome}`);
    return;
  }

  // Nome bonito para cada setor
  const nomesSetores = {
    seguranca_info: "ğŸ”’ DivisÃ£o de SeguranÃ§a da InformaÃ§Ã£o",
    psicologia: "ğŸ§  DivisÃ£o de Psicologia EstratÃ©gica",
    contra_inteligencia: "ğŸ­ DivisÃ£o Contra-InteligÃªncia",
    financas: "ğŸ’° DivisÃ£o de FinanÃ§as Secretas",
    operacao_campo: "ğŸ›°ï¸ DivisÃ£o de OperaÃ§Ã£o de Campo",
    ia_estrategica: "ğŸ¤– DivisÃ£o de IA EstratÃ©gica & Deep Learning"
  };
  
  if (idSetor === "psicologia") {
  document.getElementById("acoes-psicologia").innerHTML = `
    <h3>ğŸ§  Ferramentas de Psicologia EstratÃ©gica</h3>
    <button onclick="listarPerfis()">ğŸ“Š Ver Perfis PsicolÃ³gicos</button>
    <button onclick="avaliarRisco()">âš ï¸ Avaliar Risco dos Agentes</button>
    <button onclick="mensagemSubliminar()">ğŸ’­ Enviar Mensagem Subliminar</button>
    <button onclick="controleMoral()">ğŸ“ˆ Controle de Moral</button>
    <div id="resultado-psicologia" style="margin-top:10px;"></div>
  `;
}
 
if (idSetor === "financas") {
  document.getElementById("acoes-financas").innerHTML = `
    <h3>ğŸ’° Ferramentas de FinanÃ§as Secretas</h3>
    <button onclick="mostrarSaldos()">ğŸ“Š Cofre Virtual</button>
    <button onclick="transferirCreditos()">ğŸ’¸ Transferir CrÃ©ditos</button>
    <button onclick="auditoriaFinanceira()">ğŸ“œ Auditoria de TransaÃ§Ãµes</button>
    <button onclick="depositoPIX()">âš¡ Depositar via PIX</button>
    <button onclick="depositoBTC()">â‚¿ Depositar via Bitcoin</button>
    <div id="resultado-financas" style="margin-top:10px;"></div>
  `;
}

if (idSetor === "operacao_campo") {
  document.getElementById("acoes-operacao_campo").innerHTML = `
    <h3>ğŸ›°ï¸ Ferramentas de OperaÃ§Ã£o de Campo</h3>
    <button onclick="criarMissao()">ğŸ¯ Criar Nova MissÃ£o</button>
    <button onclick="listarMissoes()">ğŸ“‹ Listar MissÃµes</button>
    <button onclick="mapaMissoes()">ğŸ—ºï¸ Mostrar no Mapa</button>
    <button onclick="atualizarStatusMissao()">âš¡ Atualizar Status</button>
    <div id="resultado-operacao" style="margin-top:10px;"></div>
    <div id="mapa-missoes" style="height:400px; margin-top:10px;"></div>
  `;
}

if (idSetor === "ia_estrategica") {
  document.getElementById("acoes-ia_estrategica").innerHTML = `
    <h3>ğŸ¤– Ferramentas de IA EstratÃ©gica</h3>
    <button onclick="analisarLogsGlobais()">ğŸ“Š Analisar Logs Globais</button>
    <button onclick="detectarRiscoEstrategico()">âš ï¸ Detectar Risco EstratÃ©gico</button>
    <button onclick="previsaoOperacoes()">ğŸ“ˆ PrevisÃ£o de OperaÃ§Ãµes</button>
    <button onclick="gerarRelatorioEstrategico()">ğŸ“ Gerar RelatÃ³rio EstratÃ©gico</button>
    <div id="resultado-ia" style="margin-top:10px;"></div>
  `;
}

  // Exibir painel
  const conteudo = document.getElementById("conteudo");
  conteudo.innerHTML = `
    <h2>${nomesSetores[idSetor]}</h2>
    <p>ğŸ‘¤ Comandante responsÃ¡vel: <strong>${setores[idSetor]}</strong></p>
    <div id="logs-${idSetor}" style="border:1px solid lime; padding:10px; margin-top:10px; background:#000; height:200px; overflow:auto;"></div>
    <div id="acoes-${idSetor}" style="margin-top:15px;">
      <p>(Ferramentas especÃ­ficas desta divisÃ£o aparecerÃ£o aqui)</p>
    </div>
  `;

  logSetor(idSetor, `âœ… ${usuarioAtual.nome} acessou o painel administrativo`);
}

function logSetor(setorId, mensagem) {
  const key = `logs_${setorId}`;
  const logs = JSON.parse(localStorage.getItem(key) || "[]");
  logs.push(`${new Date().toLocaleTimeString()} - ${mensagem}`);
  localStorage.setItem(key, JSON.stringify(logs));

  // Exibir se o painel estiver aberto
  const area = document.getElementById(`logs-${setorId}`);
  if (area) {
    area.innerHTML = logs.map(l => `<div class="log-item">${l}</div>`).join("");
    area.scrollTop = area.scrollHeight; // auto-scroll
  }
}

// ======= DIVISÃƒO DE SEGURANÃ‡A DA INFORMAÃ‡ÃƒO =======

// 1. Monitor de Incidentes
function registrarIncidente() {
  const descricao = prompt("Descreva o incidente detectado:");
  if (!descricao) return;
  logSetor("seguranca_info", `âš ï¸ Incidente registrado: ${descricao}`);
  document.getElementById("resultado-seguranca").innerHTML =
    `<p style="color:yellow">âš ï¸ Incidente registrado: ${descricao}</p>`;
}

// 2. Gerenciamento de Chaves AES
function gerarChaveSeguranca() {
  crypto.subtle.generateKey({ name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"])
    .then(async chave => {
      const raw = await crypto.subtle.exportKey("raw", chave);
      const base64 = btoa(String.fromCharCode(...new Uint8Array(raw)));
      const chaves = JSON.parse(localStorage.getItem("chavesAES") || "[]");
      chaves.push(base64);
      localStorage.setItem("chavesAES", JSON.stringify(chaves));
      logSetor("seguranca_info", "ğŸ”‘ Nova chave AES gerada.");
      listarChaves();
    });
}

function listarChaves() {
  const chaves = JSON.parse(localStorage.getItem("chavesAES") || "[]");
  const area = document.getElementById("resultado-seguranca");
  if (chaves.length === 0) {
    area.innerHTML = "<p>(Nenhuma chave registrada)</p>";
    return;
  }
  let html = "<h4>ğŸ”‘ Chaves AES Ativas</h4><ul>";
  chaves.forEach((chave, i) => {
    html += `<li>${chave.substring(0,20)}... 
      <button onclick="revogarChave(${i})">ğŸ—‘ï¸ Revogar</button></li>`;
  });
  html += "</ul>";
  area.innerHTML = html;
}

function revogarChave(index) {
  let chaves = JSON.parse(localStorage.getItem("chavesAES") || "[]");
  if (!chaves[index]) return;
  if (confirm("Revogar esta chave?")) {
    chaves.splice(index, 1);
    localStorage.setItem("chavesAES", JSON.stringify(chaves));
    logSetor("seguranca_info", "ğŸ—‘ï¸ Uma chave AES foi revogada.");
    listarChaves();
  }
}

// 3. SimulaÃ§Ã£o de Ataque
function simularAtaque() {
  logSetor("seguranca_info", "ğŸš¨ ALERTA: Tentativa de invasÃ£o detectada!");
  document.getElementById("resultado-seguranca").innerHTML =
    `<p style="color:red">ğŸš¨ SimulaÃ§Ã£o: Tentativa de invasÃ£o detectada!</p>`;
}

// 4. Scanner Interno
function scannerInterno() {
  const pastas = JSON.parse(localStorage.getItem("pastas") || "{}");
  let vulneraveis = [];
  for (let nome in pastas) {
    if (!pastas[nome].senha || pastas[nome].senha.trim() === "") {
      vulneraveis.push(nome);
    }
  }
  if (vulneraveis.length === 0) {
    document.getElementById("resultado-seguranca").innerHTML =
      "<p style='color:lime'>âœ… Nenhuma vulnerabilidade encontrada.</p>";
    logSetor("seguranca_info", "ğŸ” Scanner concluÃ­do â€” nenhuma falha encontrada.");
  } else {
    document.getElementById("resultado-seguranca").innerHTML =
      `<p style="color:orange">âš ï¸ Pastas vulnerÃ¡veis: ${vulneraveis.join(", ")}</p>`;
    logSetor("seguranca_info", `âš ï¸ Scanner encontrou pastas vulnerÃ¡veis: ${vulneraveis.join(", ")}`);
  }
}

// ======= DIVISÃƒO DE PSICOLOGIA ESTRATÃ‰GICA =======

// 1. Listar perfis psicolÃ³gicos (baseado no quiz)
function listarPerfis() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  let html = "<h4>ğŸ“Š Perfis PsicolÃ³gicos</h4><ul>";
  for (let nome in usuarios) {
    html += `<li>${nome} â€” Perfil: ${usuarios[nome].perfil || "â“ NÃ£o definido"}</li>`;
  }
  html += "</ul>";
  document.getElementById("resultado-psicologia").innerHTML = html;
  logSetor("psicologia", "ğŸ“Š Listagem de perfis psicolÃ³gicos exibida.");
}

// 2. AvaliaÃ§Ã£o de risco
function avaliarRisco() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  let html = "<h4>âš ï¸ AvaliaÃ§Ã£o de Risco</h4><ul>";
  for (let nome in usuarios) {
    const perfil = usuarios[nome].perfil || "indefinido";
    let risco = "âœ… EstÃ¡vel";
    if (perfil.includes("sombrio")) risco = "ğŸš¨ CrÃ­tico";
    else if (perfil.includes("neutro")) risco = "âš ï¸ InstÃ¡vel";
    html += `<li>${nome} â€” ${risco}</li>`;
  }
  html += "</ul>";
  document.getElementById("resultado-psicologia").innerHTML = html;
  logSetor("psicologia", "âš ï¸ AvaliaÃ§Ã£o de risco realizada.");
}

// 3. Mensagens subliminares
function mensagemSubliminar() {
  const usuario = prompt("Enviar mensagem subliminar para qual agente?");
  const msg = prompt("Digite a mensagem subliminar:");
  if (!usuario || !msg) return;
  logSetor("psicologia", `ğŸ’­ Mensagem subliminar enviada para ${usuario}`);
  const area = document.getElementById("resultado-psicologia");
  area.innerHTML = `<p style="color:cyan">ğŸ’­ ${usuario} recebeu: "${msg}"</p>`;
  setTimeout(() => {
    area.innerHTML = "<p style='color:gray'>(Mensagem subliminar expirada)</p>";
  }, 5000);
}

// 4. Controle de moral
function controleMoral() {
  const usuario = prompt("Controle de moral â€” Qual agente?");
  const valor = parseInt(prompt("Digite o novo nÃ­vel de moral (0 a 100):"), 10);
  if (!usuario || isNaN(valor)) return;

  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  if (!usuarios[usuario]) {
    alert("Agente nÃ£o encontrado!");
    return;
  }

  usuarios[usuario].moral = Math.max(0, Math.min(100, valor));
  localStorage.setItem("usuarios", JSON.stringify(usuarios));
  logSetor("psicologia", `ğŸ“ˆ Moral de ${usuario} ajustada para ${valor}.`);
  document.getElementById("resultado-psicologia").innerHTML =
    `<p>ğŸ“ˆ Moral de ${usuario} agora Ã© ${valor}.</p>`;
}

// ======= DIVISÃƒO DE CONTRA-INTELIGÃŠNCIA =======

// 1. VerificaÃ§Ã£o de Logs Suspeitos
function verificarLogsSuspeitos() {
  const logs = JSON.parse(localStorage.getItem("logs_contra_inteligencia") || "[]");
  if (logs.length === 0) {
    document.getElementById("resultado-contra").innerHTML =
      "<p>âœ… Nenhum acesso suspeito registrado.</p>";
  } else {
    document.getElementById("resultado-contra").innerHTML =
      "<h4>ğŸ“œ Logs Suspeitos</h4><ul>" +
      logs.map(l => `<li>${l}</li>`).join("") + "</ul>";
  }
  logSetor("contra_inteligencia", "ğŸ“œ VerificaÃ§Ã£o de logs realizada.");
}

// 2. Rastrear Comportamento
function rastrearComportamento() {
  const logs = JSON.parse(localStorage.getItem("logs_contra_inteligencia") || "[]");
  let contador = {};
  logs.forEach(l => {
    const match = l.match(/por (\w+)/);
    if (match) {
      const user = match[1];
      contador[user] = (contador[user] || 0) + 1;
    }
  });

  let html = "<h4>ğŸ‘€ Rastreio de Tentativas</h4><ul>";
  for (let u in contador) {
    html += `<li>${u} â€” ${contador[u]} tentativas</li>`;
  }
  html += "</ul>";

  document.getElementById("resultado-contra").innerHTML = html;
  logSetor("contra_inteligencia", "ğŸ‘€ Rastreamento de comportamento executado.");
}

// 3. Armadilha Digital
function armadilhaDigital() {
  const pastas = JSON.parse(localStorage.getItem("pastas") || "{}");
  const fakeName = "TOP_SECRET_" + Math.floor(Math.random() * 1000);
  pastas[fakeName] = { senha: "", fake: true };
  localStorage.setItem("pastas", JSON.stringify(pastas));
  logSetor("contra_inteligencia", `ğŸª¤ Armadilha criada: ${fakeName}`);
  document.getElementById("resultado-contra").innerHTML =
    `<p>ğŸª¤ Armadilha digital criada: ${fakeName}</p>`;
}

// 4. Detector de Identidades Duplicadas
function detectarDuplicidade() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  let frases = {};
  let duplicados = [];

  for (let nome in usuarios) {
    const frase = usuarios[nome].frase || "";
    if (frases[frase]) {
      duplicados.push(`${nome} e ${frases[frase]} usam a mesma frase de seguranÃ§a`);
    } else {
      frases[frase] = nome;
    }
  }

  if (duplicados.length === 0) {
    document.getElementById("resultado-contra").innerHTML =
      "<p>âœ… Nenhuma identidade duplicada encontrada.</p>";
  } else {
    document.getElementById("resultado-contra").innerHTML =
      "<h4>ğŸ•µï¸ Identidades Duplicadas</h4><ul>" +
      duplicados.map(d => `<li>${d}</li>`).join("") + "</ul>";
  }

  logSetor("contra_inteligencia", "ğŸ•µï¸ Detector de identidades duplicadas executado.");
}

async function depositoPIX() {
  const paraUser = prompt("ID do agente que vai receber (nÃºmero):");
  const valor = parseInt(prompt("Valor (centavos):"), 10);
  const r = await fetch("http://localhost:8080/api/pix/charge", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ paraUser: Number(paraUser), valorCentavos: valor })
  });
  const j = await r.json();
  document.getElementById("resultado-financas").innerHTML =
    `<p>TXID: ${j.txid}</p><p>PIX Copia e Cola:</p><textarea>${j.copia_cola}</textarea>`;
}

async function depositoBTC() {
  const paraUser = prompt("ID do agente que vai receber (nÃºmero):");
  const valorUSD = parseFloat(prompt("Valor (USD):"));
  const r = await fetch("http://localhost:8080/api/btc/charge", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ paraUser: Number(paraUser), valorUSD })
  });
  const j = await r.json();
  document.getElementById("resultado-financas").innerHTML =
    `<p>Abra para pagar em BTC:</p><a href="${j.url}" target="_blank">${j.url}</a>`;
}

// ======= DIVISÃƒO DE OPERAÃ‡ÃƒO DE CAMPO =======

// Criar missÃ£o
function criarMissao() {
  const titulo = prompt("TÃ­tulo da missÃ£o:");
  const local = prompt("Local da missÃ£o (ex: SÃ£o Paulo - SP):");
  const agentes = prompt("Agentes envolvidos (separados por vÃ­rgula):");
  const lat = parseFloat(prompt("Latitude do local:"));
  const lng = parseFloat(prompt("Longitude do local:"));

  if (!titulo || !local || !lat || !lng) {
    alert("âŒ InformaÃ§Ãµes insuficientes para criar missÃ£o!");
    return;
  }

  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  const id = "M" + String(missoes.length + 1).padStart(3, "0");

  const nova = {
    id,
    titulo,
    local,
    coordenadas: [lat, lng],
    agentes: agentes.split(",").map(a => a.trim()),
    status: "ativa",
    criadoEm: new Date().toISOString()
  };

  missoes.push(nova);
  localStorage.setItem("missoes", JSON.stringify(missoes));

  document.getElementById("resultado-operacao").innerHTML =
    `<p>âœ… MissÃ£o criada: <strong>${nova.titulo}</strong> (${nova.id})</p>`;
  logSetor("operacao_campo", `ğŸ¯ MissÃ£o criada: ${nova.titulo} (${nova.id})`);
}

// Listar missÃµes
function listarMissoes() {
  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  if (missoes.length === 0) {
    document.getElementById("resultado-operacao").innerHTML =
      "<p>ğŸ“­ Nenhuma missÃ£o registrada.</p>";
    return;
  }

  let html = "<h4>ğŸ“‹ MissÃµes Registradas</h4><ul>";
  missoes.forEach(m => {
    html += `<li>${m.id} â€” ${m.titulo} | ${m.local} | Status: ${m.status} | Agentes: ${m.agentes.join(", ")}</li>`;
  });
  html += "</ul>";

  document.getElementById("resultado-operacao").innerHTML = html;
  logSetor("operacao_campo", "ğŸ“‹ Listagem de missÃµes exibida.");
}

// Mostrar no mapa
function mapaMissoes() {
  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  if (missoes.length === 0) {
    alert("âš ï¸ Nenhuma missÃ£o cadastrada!");
    return;
  }

  const divMapa = document.getElementById("mapa-missoes");
  divMapa.innerHTML = ""; // limpar
  const mapa = L.map(divMapa).setView(missoes[0].coordenadas, 5);

  function mapaMissoes() {
  const divMapa = document.getElementById("mapa-missoes");
  divMapa.innerHTML = ""; // limpa antes de recarregar

  // Inicia o mapa
  var mapa = L.map("mapa-missoes").setView([-15.7801, -47.9292], 4);

  // Camada base do mapa (OpenStreetMap)
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> colaboradores'
  }).addTo(mapa);

  // Recupera missÃµes do localStorage
  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");

  missoes.forEach(m => {
    if (m.local && m.local.lat && m.local.lng) {
      L.marker([m.local.lat, m.local.lng])
        .addTo(mapa)
        .bindPopup(`<b>${m.nome}</b><br>Status: ${m.status}`);
    }
  });
}

  missoes.forEach(m => {
    L.marker(m.coordenadas).addTo(mapa)
      .bindPopup(`<b>${m.titulo}</b><br>${m.local}<br>Status: ${m.status}`);
  });
<!--  -->
  logSetor("operacao_campo", "ğŸ—ºï¸ Mapa de missÃµes exibido.");
}

// Atualizar status da missÃ£o
function atualizarStatusMissao() {
  const id = prompt("Digite o ID da missÃ£o (ex: M001):");
  const status = prompt("Novo status (ativa, concluida, falha):");
  if (!id || !status) return;

  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  const missao = missoes.find(m => m.id === id);
  if (!missao) {
    alert("âŒ MissÃ£o nÃ£o encontrada!");
    return;
  }

  missao.status = status;
  localStorage.setItem("missoes", JSON.stringify(missoes));

  document.getElementById("resultado-operacao").innerHTML =
    `<p>âš¡ MissÃ£o ${id} atualizada para <strong>${status}</strong>.</p>`;
  logSetor("operacao_campo", `âš¡ MissÃ£o ${id} atualizada para ${status}.`);
}

// ======= DIVISÃƒO DE IA ESTRATÃ‰GICA & DEEP LEARNING =======

// 1. Analisar logs globais
function analisarLogsGlobais() {
  const setores = ["seguranca_info","psicologia","contra_inteligencia","financas","operacao_campo","ia_estrategica"];
  let html = "<h4>ğŸ“Š AnÃ¡lise de Logs Globais</h4><ul>";

  setores.forEach(s => {
    const logs = JSON.parse(localStorage.getItem("logs_" + s) || "[]");
    html += `<li>${s}: ${logs.length} eventos registrados</li>`;
  });

  html += "</ul>";
  document.getElementById("resultado-ia").innerHTML = html;
  logSetor("ia_estrategica", "ğŸ“Š Logs globais analisados.");
}

// 2. Detectar risco estratÃ©gico
function detectarRiscoEstrategico() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  let risco = [];

  for (let nome in usuarios) {
    const u = usuarios[nome];
    if ((u.moral || 100) < 30) {
      risco.push(`${nome} â€” ğŸš¨ Moral crÃ­tica`);
    }
    if ((u.perfil || "").includes("sombrio")) {
      risco.push(`${nome} â€” âš ï¸ Perfil psicolÃ³gico sombrio`);
    }
  }

  if (risco.length === 0) {
    document.getElementById("resultado-ia").innerHTML = "<p>âœ… Nenhum risco estratÃ©gico detectado.</p>";
  } else {
    document.getElementById("resultado-ia").innerHTML =
      "<h4>âš ï¸ Agentes em Zona de Risco</h4><ul>" + risco.map(r => `<li>${r}</li>`).join("") + "</ul>";
  }

  logSetor("ia_estrategica", "âš ï¸ DetecÃ§Ã£o de risco estratÃ©gico executada.");
}

// 3. PrevisÃ£o de operaÃ§Ãµes (baseada em missÃµes concluÃ­das/falhas)
function previsaoOperacoes() {
  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  const concluidas = missoes.filter(m => m.status === "concluida").length;
  const falhas = missoes.filter(m => m.status === "falha").length;
  const total = concluidas + falhas;

  let chance = "Indefinida";
  if (total > 0) {
    chance = Math.round((concluidas / total) * 100) + "%";
  }

  document.getElementById("resultado-ia").innerHTML =
    `<p>ğŸ“ˆ Chance estimada de sucesso em prÃ³ximas operaÃ§Ãµes: <strong>${chance}</strong></p>`;
  logSetor("ia_estrategica", "ğŸ“ˆ PrevisÃ£o de operaÃ§Ãµes calculada.");
}

// 4. Gerar relatÃ³rio estratÃ©gico (download .txt)
function gerarRelatorioEstrategico() {
  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  const missoes = JSON.parse(localStorage.getItem("missoes") || "[]");
  const auditoria = JSON.parse(localStorage.getItem("auditoria_financas") || "[]");

  let relatorio = "=== RELATÃ“RIO ESTRATÃ‰GICO CYBER NEXIS ===\n\n";

  relatorio += "ğŸ‘¥ UsuÃ¡rios Registrados:\n";
  for (let nome in usuarios) {
    relatorio += `- ${nome} | NÃ­vel: ${usuarios[nome].nivel} | Moral: ${usuarios[nome].moral || 100}\n`;
  }

  relatorio += "\nğŸ¯ MissÃµes:\n";
  missoes.forEach(m => {
    relatorio += `- ${m.id} | ${m.titulo} | Status: ${m.status} | Agentes: ${m.agentes.join(", ")}\n`;
  });

  relatorio += "\nğŸ’° Auditoria Financeira:\n";
  auditoria.slice(-5).forEach(a => {
    relatorio += `- ${a.de || "?"} -> ${a.para || "?"} | ${a.valor} | ${a.data}\n`;
  });

  const blob = new Blob([relatorio], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "relatorio_estrategico.txt";
  a.click();
  URL.revokeObjectURL(url);

  logSetor("ia_estrategica", "ğŸ“ RelatÃ³rio estratÃ©gico gerado.");
}

function mostrarFormularioComandante(nome, senha, nivel) {
  const conteudo = document.getElementById("conteudo");
  conteudo.innerHTML = `
    <h2>ğŸ“‹ Cadastro de Comandante</h2>
    <p>UsuÃ¡rio: <strong>${nome}</strong></p>
    <p>NÃ­vel: <strong>${nivel}</strong></p>

    <label>Escolha a divisÃ£o:</label>
    <select id="setorComando" onchange="mostrarPerguntasSetor()">
      <option value="">-- Selecione --</option>
      <option value="seguranca_info">ğŸ”’ SeguranÃ§a da InformaÃ§Ã£o</option>
      <option value="psicologia">ğŸ§  Psicologia EstratÃ©gica</option>
      <option value="contra_inteligencia">ğŸ­ Contra-InteligÃªncia</option>
      <option value="financas">ğŸ’° FinanÃ§as Secretas</option>
      <option value="operacao_campo">ğŸ›°ï¸ OperaÃ§Ã£o de Campo</option>
      <option value="ia_estrategica">ğŸ¤– IA EstratÃ©gica</option>
    </select>

    <div id="perguntas-setor" style="margin-top:15px;"></div>
    <button onclick="finalizarCadastroComandante('${nome}','${senha}','${nivel}')">âœ… Finalizar Cadastro</button>
  `;
}

function mostrarPerguntasSetor() {
  const setor = document.getElementById("setorComando").value;
  const area = document.getElementById("perguntas-setor");

  let html = "";
  if (setor === "seguranca_info") {
    html = `
      <p>1. VocÃª tem experiÃªncia com criptografia AES?</p>
      <input type="text" id="q1">
      <p>2. Como reagiria a uma tentativa de invasÃ£o?</p>
      <input type="text" id="q2">
    `;
  } else if (setor === "psicologia") {
    html = `
      <p>1. Como lidaria com um agente em colapso emocional?</p>
      <input type="text" id="q1">
      <p>2. O que significa disciplina estratÃ©gica para vocÃª?</p>
      <input type="text" id="q2">
    `;
  } else if (setor === "contra_inteligencia") {
    html = `
      <p>1. Como identificaria um infiltrado?</p>
      <input type="text" id="q1">
      <p>2. Qual seria sua primeira aÃ§Ã£o ao detectar duplicidade de identidade?</p>
      <input type="text" id="q2">
    `;
  } else if (setor === "financas") {
    html = `
      <p>1. Como garantiria a integridade de recursos secretos?</p>
      <input type="text" id="q1">
      <p>2. Como lidaria com suspeita de corrupÃ§Ã£o interna?</p>
      <input type="text" id="q2">
    `;
  } else if (setor === "operacao_campo") {
    html = `
      <p>1. Como coordenaria agentes em campo sob risco?</p>
      <input type="text" id="q1">
      <p>2. O que significa â€œdisciplina operacionalâ€ para vocÃª?</p>
      <input type="text" id="q2">
    `;
  } else if (setor === "ia_estrategica") {
    html = `
      <p>1. Qual a importÃ¢ncia de prever falhas antes de ocorrerem?</p>
      <input type="text" id="q1">
      <p>2. Como usaria IA para melhorar operaÃ§Ãµes da organizaÃ§Ã£o?</p>
      <input type="text" id="q2">
    `;
  }

  area.innerHTML = html;
}
function finalizarCadastroComandante(nome, senha, nivel) {
  const setor = document.getElementById("setorComando").value;
  if (!setor) {
    alert("âŒ VocÃª precisa escolher uma divisÃ£o!");
    return;
  }

  const setores = JSON.parse(localStorage.getItem("setores") || "{}");
  if (setores[setor]) {
    alert(`âŒ JÃ¡ existe um comandante registrado na divisÃ£o ${setor}.`);
    return;
  }

  const resposta1 = document.getElementById("q1")?.value || "";
  const resposta2 = document.getElementById("q2")?.value || "";

  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  usuarios[nome] = { senha, nivel, setor, respostas: [resposta1, resposta2] };
  localStorage.setItem("usuarios", JSON.stringify(usuarios));

  setores[setor] = nome;
  localStorage.setItem("setores", JSON.stringify(setores));

  log(`âœ… Comandante ${nome} registrado na divisÃ£o ${setor}.`);
  alert(`âœ… Cadastro concluÃ­do! Agora ${nome} Ã© o comandante de ${setor}.`);

  abrirSetor(setor); // jÃ¡ abre o painel do setor escolhido
}

function irParaLogin() {
  const conteudo = document.getElementById("conteudo");
  conteudo.innerHTML = `
    <h2>ğŸ”‘ Login</h2>
    <input id="login-nome" placeholder="UsuÃ¡rio"><br>
    <input id="login-senha" type="password" placeholder="Senha"><br>
    <button onclick="fazerLogin()">Entrar</button>
  `;
}

function fazerLogin() {
  const nome = document.getElementById("login-nome").value;
  const senha = document.getElementById("login-senha").value;

  const usuarios = JSON.parse(localStorage.getItem("usuarios") || "{}");
  if (!usuarios[nome]) {
    alert("âŒ UsuÃ¡rio nÃ£o encontrado!");
    return;
  }

  if (usuarios[nome].senha !== senha) {
    alert("âŒ Senha incorreta!");
    return;
  }

  alert(`âœ… Bem-vindo ${nome}!`);
  abrirPainel(usuarios[nome]); // essa funÃ§Ã£o jÃ¡ deve existir no seu sistema
}
</script>
</body>
</html>
